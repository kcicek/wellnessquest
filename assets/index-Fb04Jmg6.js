(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();async function R(r){const e=await fetch(r);if(!e.ok)throw new Error(`Failed to load ${r}`);return e.json()}async function U(){const r="data/",[e,t,s,i,o,a]=await Promise.all([R(r+"playerStats.json"),R(r+"foods.json"),R(r+"fitnessActions.json"),R(r+"diseases.json"),R(r+"economy.json"),R(r+"gameRules.json")]);return{playerStats:e.playerStats,foods:t.foods,fitnessActions:s.fitnessActions,diseases:i.diseases,economy:o,gameRules:a}}function N(r,e,t){return Math.min(t,Math.max(e,r))}function G(r,e){return new Function(...Object.keys(e),`return (${r});`)(...Object.values(e))}class ee{constructor(){Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"enabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"started",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"masterGain",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"playCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lastError",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"keepAliveId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"reinitAttempts",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxReinit",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"fallbackAudioEl",{enumerable:!0,configurable:!0,writable:!0,value:null})}init(){if(this.started&&this.ctx){this.ctx.state==="suspended"&&this.ctx.resume().catch(()=>{});return}try{this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=.6,this.masterGain.connect(this.ctx.destination),this.started=!0,this.debug&&console.log("[Audio] context started state=",this.ctx.state);const e=this.ctx.createBuffer(1,1,this.ctx.sampleRate),t=this.ctx.createBufferSource();t.buffer=e,t.connect(this.masterGain),t.start(0),this.startKeepAlive(),this.prepareFallbackElement()}catch(e){console.warn("Audio init failed",e),this.enabled=!1,this.lastError=e}}setDebug(e){this.debug=e}setEnabled(e){this.enabled=e,this.masterGain&&(this.masterGain.gain.value=e?.6:0),e&&this.confirm()}toggle(){return this.setEnabled(!this.enabled),this.enabled}status(){var e,t,s;return{started:this.started,enabled:this.enabled,ctxState:(e=this.ctx)==null?void 0:e.state,sampleRate:(t=this.ctx)==null?void 0:t.sampleRate,suspended:((s=this.ctx)==null?void 0:s.state)==="suspended",playCount:this.playCount,lastError:this.lastError?String(this.lastError):null}}logAttempt(e){this.debug&&console.log("[Audio] play attempt",e,this.status())}autoInit(){this.started||(this.debug&&console.log("[Audio] autoInit attempt"),this.init())}ensureContext(){(!this.ctx||this.ctx.state==="closed")&&(this.reinitAttempts<this.maxReinit?(this.reinitAttempts++,this.debug&&console.warn("[Audio] context missing/closed ‚Äì reinitializing attempt",this.reinitAttempts),this.started=!1,this.init()):this.debug&&console.error("[Audio] max reinit attempts reached"))}prepareFallbackElement(){if(this.fallbackAudioEl)return;const e="data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAAA";try{this.fallbackAudioEl=new Audio(e),this.fallbackAudioEl.preload="auto"}catch{}}fallbackBeep(e){if(this.fallbackAudioEl)try{this.fallbackAudioEl.currentTime=0,this.fallbackAudioEl.play().then(()=>{this.debug&&console.log("[Audio] fallback beep played",e)}).catch(t=>{this.debug&&console.warn("[Audio] fallback beep failed",t)})}catch(t){this.debug&&console.warn("[Audio] fallback beep exception",t)}}installLifecycleHandlers(){const e=()=>{try{this.ctx&&this.ctx.state==="suspended"&&(this.ctx.resume(),this.debug&&console.log("[Audio] visibility/focus resume"))}catch{}};document.addEventListener("visibilitychange",()=>{document.hidden||e()}),window.addEventListener("focus",e),window.addEventListener("pageshow",e)}startKeepAlive(){this.keepAliveId==null&&(this.keepAliveId=window.setInterval(()=>{this.ctx&&this.ctx.state==="suspended"&&(this.ctx.resume().catch(()=>{}),this.debug&&console.log("[Audio] keepAlive resume attempted",this.status()))},4e3))}playTone(e){if(this.autoInit(),this.ensureContext(),!this.enabled){this.debug&&console.warn("[Audio] skip play (disabled)",e.__label);return}if(!this.ctx||!this.masterGain){this.debug&&console.warn("[Audio] skip play (no ctx/masterGain)",e.__label,this.status());return}this.ctx.state==="suspended"&&(this.ctx.resume().catch(()=>{}),this.debug&&console.log("[Audio] resume before play",this.status())),this.logAttempt(e.__label||"tone");const{freq:t=440,type:s="sine",duration:i=.25,volume:o=.6,attack:a=.005,release:n=.12,sweepTo:l}=e;try{const d=this.ctx.createOscillator(),f=this.ctx.createGain();d.type=s,d.frequency.value=t,l&&l!==t&&(d.frequency.setValueAtTime(t,this.ctx.currentTime),d.frequency.exponentialRampToValueAtTime(Math.max(30,l),this.ctx.currentTime+i)),f.gain.setValueAtTime(0,this.ctx.currentTime),f.gain.linearRampToValueAtTime(o,this.ctx.currentTime+a),f.gain.linearRampToValueAtTime(0,this.ctx.currentTime+i+n),d.connect(f).connect(this.masterGain),d.start(),d.stop(this.ctx.currentTime+i+n+.02),this.playCount++,this.debug&&console.log("[Audio] play ok",e.__label,"count=",this.playCount),this.playCount<2&&this.fallbackBeep(e.__label)}catch(d){this.lastError=d,this.debug&&console.error("[Audio] play error",e.__label,d),this.fallbackBeep(e.__label)}}collectFood(){this.playTone({freq:540,type:"triangle",duration:.18,sweepTo:760,__label:"collectFood"})}collectFitness(){this.playTone({freq:380,type:"sawtooth",duration:.22,sweepTo:200,__label:"collectFitness"})}refresh(){this.playTone({freq:260,type:"square",duration:.16,sweepTo:520,__label:"refresh"})}dayStart(){this.playTone({freq:330,type:"triangle",duration:.25,sweepTo:660,__label:"dayStart"})}dayEndPositive(){this.playTone({freq:480,type:"sine",duration:.22,sweepTo:720,__label:"dayEndPositive"})}dayEndNegative(){this.playTone({freq:180,type:"sine",duration:.35,sweepTo:90,__label:"dayEndNegative"})}disease(){this.playTone({freq:120,type:"square",duration:.4,sweepTo:70,__label:"disease"})}death(){this.playTone({freq:70,type:"sawtooth",duration:.7,sweepTo:40,__label:"death"})}warning(){this.playTone({freq:260,type:"square",duration:.18,__label:"warning"})}confirm(){this.playTone({freq:750,type:"sine",duration:.08,sweepTo:900,volume:.4,__label:"confirm"})}testPing(){this.playTone({freq:600,type:"square",duration:.15,sweepTo:500,volume:.5,__label:"testPing"})}__bufferTest(){if(this.autoInit(),this.ensureContext(),!this.ctx||!this.masterGain){this.debug&&console.warn("[Audio] bufferTest no ctx");return}try{const e=this.ctx.sampleRate,t=Math.floor(e*.25),s=this.ctx.createBuffer(1,t,e),i=s.getChannelData(0);for(let a=0;a<t;a++){const n=a/e,l=Math.min(1,n/.01)*Math.min(1,(.25-n)/.05);i[a]=Math.sin(2*Math.PI*660*n)*l*.5}const o=this.ctx.createBufferSource();o.buffer=s,o.connect(this.masterGain),o.start(),this.playCount++,this.debug&&console.log("[Audio] bufferTest ok count=",this.playCount)}catch(e){this.lastError=e,this.debug&&console.error("[Audio] bufferTest error",e),this.fallbackBeep("bufferTest")}}}const E=new ee;window.audioManager=E;class Y{constructor(e){Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selectedFoods",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"selectedFitness",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"dayLog",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"hardshipFactor",{enumerable:!0,configurable:!0,writable:!0,value:1}),this.data=e,this.state=this.initState()}initState(){return{...this.data.playerStats,day:1,streakHealthyMeals:0,history:{sugar:[],cholesterol:[],sodium:[]},activeDiseases:[],blockedWork:!1}}getLog(){return this.dayLog.join(`
`)}pushLog(e){this.dayLog.push(e)}resetDayLog(){this.dayLog=[]}setHardshipFactor(e){e<.25?e=.25:e>3&&(e=3),this.hardshipFactor=Number(e.toFixed(2)),this.pushLog(`Hardship factor set to ${this.hardshipFactor}x`)}setFood(e){Array.isArray(e)?this.selectedFoods=e:this.selectedFoods=[e]}setFitness(e){this.selectedFitness=e}nextDay(){this.resetDayLog(),this.pushLog(`--- Day ${this.state.day} ---`),this.eatPhase(),this.fitnessPhase(),this.workPhase(),this.diseaseCheckPhase(),this.endOfDay(),this.state.day++}applyFoodEffects(e){const t=this.state;t.energy+=e.energy,t.vitamins+=e.vitamins,t.protein+=e.protein,t.sugar+=e.sugar,t.cholesterol+=e.cholesterol,t.sodium+=e.sodium,t.mood+=e.mood,t.fitness+=e.fitness,e.minerals&&(t.minerals+=e.minerals),t.money-=e.price}eatPhase(){if(!this.selectedFoods.length){this.pushLog("No food selected.");return}let e=0;this.selectedFoods.forEach(t=>{this.pushLog(`Eating: ${t.name}`),this.applyFoodEffects(t),t.sugar<=3&&t.cholesterol<=2&&t.vitamins>=3&&e++}),e===this.selectedFoods.length&&e>0?(this.state.streakHealthyMeals++,this.pushLog(`Healthy meal streak: ${this.state.streakHealthyMeals}`)):this.state.streakHealthyMeals=0}fitnessPhase(){if(!this.selectedFitness){this.pushLog("No fitness action selected.");return}const e=this.selectedFitness;this.pushLog(`Fitness: ${e.action}`),this.state.money-=e.cost,this.state.energy+=e.energyChange,this.state.fitness+=e.fitnessChange,this.state.mood+=e.moodChange}workPhase(){if(this.state.blockedWork){this.pushLog("Unable to work due to a condition.");return}const{economy:e}=this.data,t={...this.state,baseIncome:e.baseIncome,fitness:this.state.fitness,energy:this.state.energy};let s=G(e.incomeFormula.split("=")[1].trim(),t);this.state.mood<25?s*=e.lowMoodPenalty:s+=s*e.moodBonus*(this.state.mood/100);const i=["vitamins","minerals","protein"].filter(l=>this.state[l]>=60).length,o=G(e.healthBonusFormula.replace("healthyStats",i.toString()),{healthyStats:i});s*=o;const n=.5+N(this.state.fitness,0,100)/100*.7;s*=n,this.pushLog(`Fitness multiplier applied: x${n.toFixed(2)}`),this.state.streakHealthyMeals>=3&&this.state.fitness>=70&&(s+=e.peakBonus,this.pushLog("Peak condition bonus applied."));for(const l of this.state.activeDiseases)l.effect.incomeMultiplier!==void 0&&(s*=l.effect.incomeMultiplier),l.effect.money&&(s+=l.effect.money);s=s/this.hardshipFactor,s=Math.max(0,Math.round(s)),this.pushLog(`Income earned: ${s}`),this.state.money+=s}diseaseCheckPhase(){const e=this.state,t=e.history;t.sugar.push(e.sugar),t.sugar.length>5&&t.sugar.shift(),t.cholesterol.push(e.cholesterol),t.cholesterol.length>5&&t.cholesterol.shift(),t.sodium.push(e.sodium),t.sodium.length>5&&t.sodium.shift();const s=[];for(const i of this.data.diseases){if(e.activeDiseases.find(n=>n.name===i.name))continue;const o=i.trigger;let a=!1;o.includes("sugar > 110")?a=t.sugar.slice(-3).every(n=>n>110):o.includes("cholesterol > 110")?a=t.cholesterol.slice(-2).every(n=>n>110):o.includes("sodium > 110")?a=t.sodium.slice(-3).every(n=>n>110):o.includes("energy < 20")?a=e.energy<20:o.includes("mood < 25")&&(a=e.mood<25),a&&(s.push(i),e.activeDiseases.push(i),i.effect.canWork===!1&&(e.blockedWork=!0))}for(const i of s)this.pushLog(`Disease triggered: ${i.name}`),i.effect.energy&&(e.energy+=i.effect.energy),i.effect.mood&&(e.mood+=i.effect.mood),i.effect.money&&(e.money+=i.effect.money);s.length&&E.disease()}endOfDay(){const e=this.data.gameRules.rules.statDecay;for(const[i,o]of Object.entries(e)){const a=o*this.hardshipFactor;this.state[i]+=a}this.adjustHealth();const t=this.data.gameRules.rules.statLimits,s=["energy","fitness","mood","vitamins","minerals","protein","sugar","cholesterol","sodium","health"];for(const i of s){const a={energy:t.energyMax,fitness:t.fitnessMax,mood:t.moodMax,health:t.healthMax}[i]??t.max;this.state[i]=N(this.state[i],t.min,a)}this.evaluateDeath(),this.pushLog("End of day: stats decayed & clamped.")}adjustHealth(){const e=this.state;let t=0;const s=i=>{t+=i};for(const i of["vitamins","minerals","protein"]){const o=e[i];o<20?s(-4):o<40&&s(-2)}["vitamins","minerals","protein"].every(i=>e[i]>=60)&&s(3);for(const i of["sugar","cholesterol","sodium"]){const o=e[i];o>=110?s(-5):o>=100&&s(-2)}e.energy<15?s(-6):e.energy<25&&s(-3),e.mood<15?s(-6):e.mood<25&&s(-3),e.fitness>=70&&e.mood>=60&&e.energy>=60&&s(2),e.streakHealthyMeals>=3&&s(2),t<-12?t=-12:t>8&&(t=8),t!==0?(e.health+=t,this.pushLog(`Health adjusted by ${t} from cross-stat factors.`)):this.pushLog("Health unchanged by cross-stat factors.")}evaluateDeath(){const e=this.state;if(e.isDead||e.health>=50)return;const t=Math.min(.9,.02+(50-e.health)/50*.88),s=Math.random();this.pushLog(`Death check: health=${e.health} chance=${(t*100).toFixed(1)}% roll=${(s*100).toFixed(1)}%`),s<t&&(e.isDead=!0,e.deathReason=this.deriveDeathReason(),this.pushLog(`YOU DIED: ${e.deathReason}`),E.death())}deriveDeathReason(){const e=this.state,t=[];return e.sugar>115&&t.push("Complications from high sugar"),e.cholesterol>115&&t.push("Cardiovascular failure"),e.sodium>115&&t.push("Hypertensive crisis"),e.energy<10&&t.push("Systemic exhaustion"),e.mood<10&&t.push("Severe depressive collapse"),t.length===0?"Health failure":t[0]}}const q={health:"‚ù§Ô∏è",money:"üí∞",energy:"‚ö°",fitness:"üí™",mood:"üòä",minerals:"ü™®",sugar:"üç¨",sodium:"üßÇ",vitamins:"üíä",protein:"ü•ö",cholesterol:"ü´Ä"},K=["health","money","energy","fitness","mood"],X=["minerals","sugar","sodium","vitamins","protein","cholesterol"];let M=null;const te=.15,se=.3,ie=105,ne=115,ae=15,oe=5,re=50,le=30;function ce(r,e,t){const s=t.data.gameRules.rules.statLimits,o={energy:s.energyMax,fitness:s.fitnessMax,mood:s.moodMax,health:s.healthMax}[r]??s.max,a=s.min;if(r==="health")return e<=le?{cls:"danger"}:e<=re?{cls:"warning"}:{cls:""};if(r==="money")return e<=oe?{cls:"danger"}:e<=ae?{cls:"warning"}:{cls:""};if(["sugar","cholesterol","sodium"].includes(r)){if(e>=ne)return{cls:"danger"};if(e>=ie)return{cls:"warning"}}const n=e/o;return e<=a+o*te?{cls:"danger"}:n<=se?{cls:"warning"}:{cls:""}}function D(r){const e=document.querySelector(r);if(!e)throw new Error(`Missing element ${r}`);return e}function B(r){typeof console<"u"&&console.log("[Game]",r)}function z(r,e){if(!M)return"";const t=M[r];if(t===void 0)return"";const s=e-t;if(s===0)return"";const i=s>0?"‚ñ≤":"‚ñº";return`<span class="delta ${s>0?"up":"down"}" aria-hidden="true">${i}${Math.abs(Math.round(s))}</span>`}function de(r){const e=D("#stats");e.innerHTML="";const t=(s,i=!1,o=!1)=>{const a=document.createElement("div");return a.className="stats-bar"+(i?" nutrient-bar":""),s.forEach(n=>{const l=r.state[n],d=Math.round(l),f=ce(n,d,r),u=document.createElement("span");u.className="stat-seg"+(f.cls?" "+f.cls:"")+(i||o?" nutrient":""),u.setAttribute("data-stat",n),u.title=n.charAt(0).toUpperCase()+n.slice(1),i||o?u.innerHTML=`<span class="i" aria-label="${n}">${q[n]||n} <span class="v inline">${d}</span></span>${z(n,d)}`:u.innerHTML=`<span class="i" aria-label="${n}">${q[n]||n}</span><span class="v">${d}</span>${z(n,d)}`,a.appendChild(u)}),a};e.appendChild(t(K,!1,!0)),e.appendChild(t(X,!0)),fe(e)}function j(r){M={},[...K,...X].forEach(e=>M[e]=r.state[e])}function H(r){de(r)}function P(r){try{const e=document.getElementById("daysSurvived");if(e){const t=e.querySelector(".label");t&&(t.textContent=`Day ${r.state.day}`)}}catch{}}function ue(r){return M?M[r]??null:null}function he(r){const e=document.getElementById("penaltyLog");if(!e)return;const t=r.getLog().split(/\n+/).filter(u=>u.trim().length),s=/^---\s*Day\s+\d+\s*---$/i,i=/^Eating:\s*(.+)$/i,o=/([\p{Emoji_Presentation}\p{Extended_Pictographic}])/u,a=[];let n=null;const l=()=>{if(!n)return;const u=n.lines.filter(h=>!/^Eating:/i.test(h));if(n.eatItems.length){const h=new Set,y=n.eatItems.map(b=>{const S=b.match(o),m=S?S[1]:b;return h.has(m)?null:(h.add(m),m)}).filter(Boolean);a.push(`Eating: ${y.join(", ")}`)}a.push(...u),n=null};for(const u of t){if(s.test(u)){l(),a.push(u.replace(/^---\s*/,"").trim()),n={header:u,lines:[],eatItems:[]};continue}const h=u.match(i);if(h&&n){n.eatItems.push(h[1].trim());continue}n?n.lines.push(u):a.push(u)}l();const d=a.slice(-40),f=u=>/Health adjusted by -/.test(u)||/Disease triggered/i.test(u)||/Unable to work/i.test(u)?"penalty":/Health adjusted by \+/.test(u)||/bonus applied/i.test(u)?"bonus":/Day \d+/.test(u)?"day":"neutral";e.innerHTML=d.map(u=>`<div class="line ${f(u)}">${u.replace(/^---\s*/,"")}</div>`).join(""),e.scrollTop=e.scrollHeight}let O=null;function fe(r){r.querySelectorAll(".stat-seg").forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation();const i=(t.getAttribute("data-stat")||"").trim();V(t,i.charAt(0).toUpperCase()+i.slice(1))},{passive:!0}),t.addEventListener("touchstart",s=>{s.stopPropagation();const i=(t.getAttribute("data-stat")||"").trim();V(t,i.charAt(0).toUpperCase()+i.slice(1))},{passive:!0})}),document.addEventListener("click",$,{once:!0}),document.addEventListener("touchstart",$,{once:!0})}function V(r,e){$();const t=document.createElement("div");t.className="stat-tooltip-bubble",t.textContent=e,document.body.appendChild(t);const s=r.getBoundingClientRect(),i=t.offsetWidth,o=t.offsetHeight;t.style.left=`${s.left+s.width/2-i/2}px`,t.style.top=`${s.top-o-8}px`,O=t}function $(){O&&O.parentNode&&O.parentNode.removeChild(O),O=null}const C=3,T=4;class Z{constructor(e,t=5e3){Object.defineProperty(this,"game",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"grid",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"playerCol",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"remaining",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"foodsCollected",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"fitnessChosen",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastTick",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"dayCounter",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"paused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"bottomRefreshed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"dayDurationMs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.game=e,this.dayDurationMs=t,this.initEmptyGrid(),this.randomizeTopRows(C),this.playerCol=Math.floor(T/2),this.render(),this.bindControls()}setDayDurationSeconds(e){const t=Math.round(e*1e3);t<1e3||(this.dayDurationMs=t)}initEmptyGrid(){this.grid=Array.from({length:C},()=>Array.from({length:T},()=>({type:"empty",emoji:""})))}shuffle(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[s],e[s]=i}return e}getFitnessActions(){return this.game.data.fitnessActions.filter(e=>/go to gym/i.test(e.action))}generateRow(){const e=this.shuffle([...this.game.data.foods]),t=this.getFitnessActions()[0],s=Math.random()<.55&&!!t,o=e.slice(0,s?3:4).map(a=>({type:"food",food:a,emoji:this.extractEmoji(a.name)}));return s&&t&&o.push({type:"fitness",fitness:t,emoji:t.action.split(" ").slice(-1)[0]}),this.shuffle(o).slice(0,T)}extractEmoji(e){const t=e.trim().split(/\s+/),s=t[t.length-1];return/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/u.test(s)?s:"‚ùî"}randomizeTopRows(e){for(let t=0;t<e;t++)this.grid[t]=this.generateRow()}shiftDownAndAddRow(){for(let e=C-1;e>0;e--)this.grid[e]=this.grid[e-1];this.grid[0]=this.generateRow()}startDay(){if(this.running)return;if(!window.__WQ_ALLOW_START&&!localStorage.getItem("wq.started.v1")){console.info("[DailyRunMinigame] startDay blocked (no allow flag & no persisted start flag)");return}this.running=!0;try{localStorage.getItem("wq.started.v1")||(localStorage.setItem("wq.started.v1","1"),console.log("[WelcomeOverlay] Flag set from startDay"))}catch{}const e=document.getElementById("welcomeOverlay");e&&(window.__WQ_USER_START?(e.remove(),console.log("[WelcomeOverlay] Removed from startDay (explicit user start)")):console.log("[WelcomeOverlay] Overlay present but preserved (no explicit user start flag)")),this.dayCounter++,this.foodsCollected=[],this.fitnessChosen=null,this.remaining=this.dayDurationMs,this.lastTick=performance.now(),this.bottomRefreshed=!1,this.render();const t=document.getElementById("daysSurvived");if(t){const s=t.querySelector(".progress");s&&(s.style.width="0%")}j(this.game),E.dayStart(),this.tick()}tick(){if(!this.running)return;if(this.game.state.isDead){this.running=!1;return}if(this.paused){requestAnimationFrame(()=>this.tick());return}const e=performance.now(),t=e-this.lastTick;this.lastTick=e,this.remaining-=t;const s=document.getElementById("daysSurvived");if(s){const i=s.querySelector(".progress");if(i){const o=this.dayDurationMs-this.remaining,a=Math.min(1,Math.max(0,o/this.dayDurationMs));i.style.width=(a*100).toFixed(2)+"%"}}if(this.remaining<=0){this.endDay();return}requestAnimationFrame(()=>this.tick())}endDay(){this.running=!1,this.foodsCollected.length&&this.game.setFood(this.foodsCollected),this.fitnessChosen&&this.game.setFitness(this.fitnessChosen);const e=ue("health");this.game.nextDay(),B(this.game.getLog()),H(this.game),he(this.game),P(this.game);const t=document.getElementById("daysSurvived");if(t){t.classList.remove("animate-day"),t.offsetWidth,t.classList.add("animate-day");const s=t.querySelector(".progress");s&&(s.style.width="100%")}if(this.game.state.isDead){E.death(),this.showGameOver();return}if(e!=null){const s=this.game.state.health;s>e?E.dayEndPositive():s<e&&E.dayEndNegative()}this.animateShiftWithNewRow()}showGameOver(){const e=D("#gameGrid"),t=document.createElement("div");t.style.position="absolute",t.style.inset="0",t.style.background="radial-gradient(circle at 50% 40%, rgba(10,15,25,0.3), rgba(3,6,10,0.95)), #020509",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center",t.style.color="#e9eef5",t.style.fontSize="0.8rem",t.style.letterSpacing=".5px",t.style.overflow="hidden";const s=this.game.state.day-1,i=this.game.state.deathReason||"Health failure",o=document.createElement("div");o.style.position="absolute",o.style.inset="0",o.style.pointerEvents="none",o.style.background="repeating-linear-gradient(0deg, rgba(255,255,255,0.025) 0 2px, transparent 2px 4px), linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 85%)",o.style.opacity="0.4",t.appendChild(o);const a=document.createElement("div");a.style.textAlign="center",a.style.maxWidth="260px",a.style.lineHeight="1.35",a.style.position="relative",a.style.padding="1.1rem 1.2rem 1.3rem",a.style.background="rgba(8,14,22,0.65)",a.style.border="1px solid #1e2f45",a.style.borderRadius="18px",a.style.boxShadow="0 0 0 3px rgba(255,255,255,0.05) inset, 0 12px 28px -6px rgba(0,0,0,0.8)",a.style.backdropFilter="blur(6px)";const n=document.createElement("div");n.textContent="Your Journey Ends",n.style.fontSize="0.75rem",n.style.letterSpacing=".35px",n.style.textTransform="uppercase",n.style.color="#9cb8d4",n.style.fontWeight="600",a.appendChild(n);const l=document.createElement("div");l.textContent="üíÄ",l.style.fontSize="2.6rem",l.style.lineHeight="1",l.style.margin="0.2rem 0 0.4rem",l.style.filter="drop-shadow(0 0 6px #5b0000)",a.appendChild(l);const d=document.createElement("div");d.textContent="You Died",d.style.fontSize="0.95rem",d.style.fontWeight="700",d.style.letterSpacing=".5px",d.style.color="#fff",d.style.textShadow="0 0 6px rgba(255,0,0,0.35)",a.appendChild(d);const f=document.createElement("div");f.innerHTML=`Survived <strong>${s}</strong> ${s===1?"Day":"Days"}.`,f.style.marginTop="0.5rem",f.style.fontSize="0.7rem",f.style.color="#c3d2e0",a.appendChild(f);const u=document.createElement("div");u.textContent=i,u.style.marginTop="0.4rem",u.style.fontSize="0.6rem",u.style.color="#ffb3b3",u.style.fontStyle="italic",a.appendChild(u);const h=document.createElement("button");h.id="reloadBtn",h.textContent="Restart",h.style.marginTop="0.8rem",h.style.background="linear-gradient(145deg,#ff5252,#c21212)",h.style.color="#fff",h.style.border="none",h.style.padding="8px 14px",h.style.borderRadius="10px",h.style.cursor="pointer",h.style.fontSize="0.65rem",h.style.fontWeight="600",h.style.letterSpacing=".5px",h.style.boxShadow="0 4px 14px -4px rgba(255,0,0,0.5)",a.appendChild(h);const y=document.createElement("div");y.textContent="Balance was lost...",y.style.marginTop="0.65rem",y.style.fontSize="0.5rem",y.style.letterSpacing=".4px",y.style.opacity="0.45",a.appendChild(y),t.appendChild(a),t.animate([{opacity:0},{opacity:1}],{duration:600,easing:"ease-out"}),setInterval(()=>{t.style.backgroundPosition=`${Math.random()*4}px ${Math.random()*4}px`},1400);const b=e.parentElement;b.style.position="relative",b.appendChild(t),h.addEventListener("click",()=>{location.reload()})}getRecentDayNames(){const e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],t=(this.dayCounter-1+e.length*1e3)%e.length,s=(t+1)%e.length,i=(t+2)%e.length;return{top:e[i],mid:e[s],bottom:e[t]}}bindControls(){window.addEventListener("keydown",t=>{!this.running||this.paused||(t.key==="ArrowLeft"?(this.playerCol=Math.max(0,this.playerCol-1),this.collect(),this.render()):t.key==="ArrowRight"?(this.playerCol=Math.min(T-1,this.playerCol+1),this.collect(),this.render()):t.key===" "&&(this.collect(),this.render()))});const e=document.getElementById("pauseBtn");e&&e.addEventListener("click",()=>{this.paused=!this.paused,e.setAttribute("aria-pressed",this.paused?"true":"false"),e.textContent=this.paused?"‚ñ∂":"‚è∏"})}collect(){var t,s,i,o,a,n;if(this.paused)return;const e=this.grid[C-1][this.playerCol];if(e.type==="food"&&e.food){if(this.foodsCollected.push(e.food),e.type="empty",e.food=void 0,e.emoji="",(t=window.audioManager)!=null&&t.setDebug){const l=(i=(s=window.audioManager).status)==null?void 0:i.call(s);console.log("[Game] collectFood triggering sound",l)}E.collectFood()}else if(e.type==="fitness"&&e.fitness){if(this.fitnessChosen=e.fitness,e.type="empty",e.fitness=void 0,e.emoji="",(o=window.audioManager)!=null&&o.setDebug){const l=(n=(a=window.audioManager).status)==null?void 0:n.call(a);console.log("[Game] collectFitness triggering sound",l)}E.collectFitness()}}render(){const e=D("#gameGrid");e.innerHTML="";const t=this.getRecentDayNames();for(let s=0;s<C;s++){const i=document.createElement("div");i.className="row-label",i.textContent=s===0?t.top:s===1?t.mid:t.bottom,e.appendChild(i);for(let o=0;o<T;o++){const a=this.grid[s][o],n=document.createElement("div");n.className="cell",a.type==="food"&&n.classList.add("food"),a.type==="fitness"&&n.classList.add("fitness"),s===0?n.classList.add("future-strong"):s===1&&n.classList.add("future-mid"),s===C-1&&o===this.playerCol&&n.classList.add("player");let l="",d="";if(a.type==="food"&&a.food?(l=a.food.name.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),d=`Vit:${a.food.vitamins} Sug:${a.food.sugar} $${a.food.price}`):a.type==="fitness"&&a.fitness&&(l=a.fitness.action.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),d=`Fit:${a.fitness.fitnessChange} Eng:${a.fitness.energyChange} $${a.fitness.cost}`),n.innerHTML=`<span class="grid-emoji">${a.emoji}</span><span class="grid-label">${l}</span><span class="grid-details">${d}</span>`,s===C-1){n.style.cursor="pointer";const f=()=>{this.running&&(this.playerCol=o,this.collect(),this.render())};n.addEventListener("click",f),n.addEventListener("touchstart",f,{passive:!0})}else if(s===1){n.style.cursor="pointer";const f=()=>{this.running&&(this.playerCol=o,this.collectMiddleRow(o))};n.addEventListener("click",f),n.addEventListener("touchstart",f,{passive:!0})}e.appendChild(n)}}this.ensureFixedArrow(),this.ensureFixedArrow()}collectMiddleRow(e){var s,i,o,a,n,l;if(!this.running||this.paused)return;const t=this.grid[1][e];if(t.type==="food"&&t.food){if(this.foodsCollected.push(t.food),t.type="empty",t.food=void 0,t.emoji="",(s=window.audioManager)!=null&&s.setDebug){const d=(o=(i=window.audioManager).status)==null?void 0:o.call(i);console.log("[Game] collectFood (midRow) triggering sound",d)}E.collectFood()}else if(t.type==="fitness"&&t.fitness){if(this.fitnessChosen=t.fitness,t.type="empty",t.fitness=void 0,t.emoji="",(a=window.audioManager)!=null&&a.setDebug){const d=(l=(n=window.audioManager).status)==null?void 0:l.call(n);console.log("[Game] collectFitness (midRow) triggering sound",d)}E.collectFitness()}this.endDay()}ensureFixedArrow(){const e=D("#gameGrid").parentElement;if(!e)return;let t=e.querySelector(".fixed-refresh-btn");if(t||(t=document.createElement("div"),t.className="fixed-refresh-btn",e.appendChild(t)),t.classList.toggle("used",this.bottomRefreshed),this.bottomRefreshed)t.innerHTML='‚ü≥<span style="font-size:0.45rem; font-weight:600;">USED</span>',t.style.pointerEvents="none";else{t.innerHTML='‚ñ∂<span style="font-size:0.45rem; font-weight:600;">MORE</span>',t.style.pointerEvents="auto";const s=()=>{!this.running||this.paused||this.refreshBottomOptions()};t.replaceWith(t.cloneNode(!0)),t=e.querySelector(".fixed-refresh-btn"),t.addEventListener("click",s),t.addEventListener("touchstart",s,{passive:!0})}}animateShiftWithNewRow(){const e=D("#gameGrid"),t=e.parentElement,i=e.getBoundingClientRect().height/C,o=this.generateRow(),a=this.grid.map(h=>[...h]);for(let h=C-1;h>0;h--)this.grid[h]=a[h-1];this.grid[0]=o;const n=document.createElement("div");n.className="grid";const l=[this.grid[0],a[0],a[1],a[2]],d=this.getRecentDayNames();n.innerHTML=l.map((h,y)=>{const b=`<div class="row-label">${y===0?d.top:y===1?d.mid:d.bottom}</div>`,S=h.map((m,F)=>{const p=y===l.length-1&&F===this.playerCol;let A="",v="";m.type==="food"&&m.food?(A=m.food.name.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),v=`Vit:${m.food.vitamins} Sug:${m.food.sugar} $${m.food.price}`):m.type==="fitness"&&m.fitness&&(A=m.fitness.action.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),v=`Fit:${m.fitness.fitnessChange} Eng:${m.fitness.energyChange} $${m.fitness.cost}`);const c=["cell"];m.type==="food"&&c.push("food"),m.type==="fitness"&&c.push("fitness"),p&&c.push("player"),y===0?c.push("future-strong"):y===1&&c.push("future-mid");const g=y===l.length-1?' style="opacity:1;"':"";return`<div class="${c.join(" ")}"${g}><span class="grid-emoji">${m.emoji}</span><span class="grid-label">${A}</span><span class="grid-details">${v}</span></div>`}).join("");return b+S}).join("");const f=document.createElement("div");f.className="grid-clone-layer",f.style.height=e.style.height,f.appendChild(n),n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top=`-${i}px`,n.style.transform=`translateY(-${i}px)`,n.style.transition="transform .7s cubic-bezier(.45,.85,.4,1)",e.style.transition="transform .7s cubic-bezier(.45,.85,.4,1), opacity .7s linear",e.style.transform=`translateY(${i}px)`,e.style.opacity="0",t.style.position="relative",t.appendChild(f),requestAnimationFrame(()=>{n.style.transform="translateY(0)",e.style.transform=`translateY(${i}px)`});const u=()=>{n.removeEventListener("transitionend",u),t.removeChild(f),e.style.transition="",e.style.transform="",e.style.opacity="1",this.render(),this.injectNextDayControls();try{localStorage.getItem("wq.autoNextDay")==="1"&&!this.game.state.isDead&&setTimeout(()=>{this.startDay()},350)}catch{}};n.addEventListener("transitionend",u)}injectNextDayControls(){let e=document.getElementById("nextDayBar");if(!e){e=document.createElement("div"),e.id="nextDayBar",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="space-between",e.style.gap="0.5rem",e.style.marginTop="0.45rem",e.style.background="#eef3f9",e.style.border="1px solid #d2dde9",e.style.padding="0.4rem 0.55rem",e.style.borderRadius="10px",e.style.boxShadow="0 2px 4px rgba(0,0,0,0.08)";const a=document.querySelector("#minigame");a&&a.appendChild(e)}e.innerHTML="";const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.5rem",t.style.fontSize="0.55rem",t.style.letterSpacing=".5px",t.style.fontWeight="600",t.style.color="#234",t.textContent=`Day ${this.game.state.day} ready`;const s=document.createElement("button");s.type="button",s.textContent="Start Next Day ‚ñ∏",s.style.background="#3f6cb3",s.style.color="#fff",s.style.border="none",s.style.padding="0.45rem 0.75rem",s.style.fontSize="0.6rem",s.style.fontWeight="600",s.style.borderRadius="8px",s.style.cursor="pointer",s.style.letterSpacing=".5px",s.addEventListener("click",()=>{this.startDay()});const i=document.createElement("label");i.style.display="flex",i.style.alignItems="center",i.style.gap="4px",i.style.fontSize="0.5rem",i.style.letterSpacing=".5px",i.style.fontWeight="600",i.style.color="#345";const o=document.createElement("input");o.type="checkbox";try{o.checked=localStorage.getItem("wq.autoNextDay")==="1"}catch{}o.addEventListener("change",()=>{try{localStorage.setItem("wq.autoNextDay",o.checked?"1":"0")}catch{}}),i.appendChild(o),i.appendChild(document.createTextNode("Auto")),e.appendChild(t),e.appendChild(s),e.appendChild(i)}refreshBottomOptions(){if(this.bottomRefreshed)return;this.bottomRefreshed=!0,E.refresh();const e=this.grid[C-1],t=this.generateRow(),s=D("#gameGrid"),i=s.parentElement,a=s.getBoundingClientRect().height/C,n=document.createElement("div");n.className="bottom-refresh-layer",n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.height=`${a}px`,n.style.pointerEvents="none",i.style.position="relative";const l=document.createElement("div");l.style.position="absolute",l.style.inset="0",l.style.display="grid";const d=T+1;l.style.gridTemplateColumns=`24px repeat(${T}, 1fr)`,l.style.transform="translateX(0)",l.style.transition="transform .55s cubic-bezier(.55,.1,.3,1)";const f=(p,A)=>{let v="",c="";p.type==="food"&&p.food?(v=p.food.name.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),c=`Vit:${p.food.vitamins} Sug:${p.food.sugar} $${p.food.price}`):p.type==="fitness"&&p.fitness&&(v=p.fitness.action.replace(/([\u{1F300}-\u{1FAFF}\u{2600}-\u{27BF}])/gu,"").trim(),c=`Fit:${p.fitness.fitnessChange} Eng:${p.fitness.energyChange} $${p.fitness.cost}`);const g=["cell"];return p.type==="food"&&g.push("food"),p.type==="fitness"&&g.push("fitness"),A&&g.push("player"),`<div class="${g.join(" ")}"><span class="grid-emoji">${p.emoji}</span><span class="grid-label">${v}</span><span class="grid-details">${c}</span></div>`},u=`<div class="row-label">${this.getRecentDayNames().bottom}</div>`,h=u+e.map((p,A)=>f(p,A===this.playerCol)).join(""),y=u+t.map((p,A)=>f(p,A===this.playerCol)).join(""),b=document.createElement("div");b.style.display="grid",b.style.gridTemplateColumns=`repeat(2, ${d} * 1fr)`,b.style.position="absolute",b.style.inset="0",b.style.width="200%",b.style.display="flex";const S=document.createElement("div");S.className="bottom-old",S.style.display="grid",S.style.gridTemplateColumns=`24px repeat(${T}, 1fr)`,S.innerHTML=h;const m=document.createElement("div");m.className="bottom-new",m.style.display="grid",m.style.gridTemplateColumns=`24px repeat(${T}, 1fr)`,m.innerHTML=y,b.appendChild(S),b.appendChild(m),l.appendChild(b),n.appendChild(l),i.appendChild(n),requestAnimationFrame(()=>{l.style.transform="translateX(-50%)"});const F=()=>{l.removeEventListener("transitionend",F),n.remove(),this.grid[C-1]=t,this.render(),this.ensureFixedArrow()};l.addEventListener("transitionend",F)}}const me={};(async function(){B("Loading data...");const e=await U(),t=new Y(e);window.game=t,j(t),H(t),P(t);const s=new Z(t,5e3);window.minigame=s,B("Game initialized. Configure settings then start your first day.")})();let Q=0;const pe=8;let _=null;function ge(r,e){if(_!=null)return;const t=()=>{if(window.__WQ_USER_START){_&&clearTimeout(_),_=null;return}!!!document.getElementById("welcomeOverlay")&&!e()&&(console.info("[WelcomeOverlay] heal loop reinject (overlay missing, not started)"),r()),Q++,Q<pe?_=window.setTimeout(t,700):(console.info("[WelcomeOverlay] heal loop finished"),_=null)};_=window.setTimeout(t,700)}function ye(r,e){if(!window.__WQ_OVERLAY_GUARD)try{const t=new MutationObserver(()=>{if(window.__WQ_USER_START)return;!!!document.getElementById("welcomeOverlay")&&!e()&&(console.info("[WelcomeOverlay] guardian reinject (overlay removed unexpectedly)"),r())});t.observe(document.body,{childList:!0}),window.__WQ_OVERLAY_GUARD=t,console.info("[WelcomeOverlay] guardian attached")}catch(t){console.info("[WelcomeOverlay] guardian attach failed",t)}}"serviceWorker"in navigator&&(me?window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").catch(r=>console.warn("SW registration failed",r)),setTimeout(()=>{const r=document.querySelector("header img");if(r instanceof HTMLImageElement&&(!r.complete||r.naturalWidth===0)){console.warn("Header icon not loaded, forcing reload of src");const e=r.getAttribute("src");e&&(r.src=e+"?v="+Date.now())}},600)}):(navigator.serviceWorker.getRegistrations().then(r=>{r.length&&console.info("[DevSW] Unregistering stale service workers:",r.length),r.forEach(e=>e.unregister())}).catch(()=>{}),caches&&caches.keys&&caches.keys().then(r=>{r.filter(e=>/wellnessquest|vite|workbox/i.test(e)).forEach(e=>caches.delete(e))}).catch(()=>{})));document.addEventListener("DOMContentLoaded",()=>{const r="wq.started.v1",e="wq.started",t="wq.intro.shown.session",s=(c,g)=>console.info("[WelcomeOverlay]",c,g||"");let i=!1;const o=()=>!!localStorage.getItem(r);try{!localStorage.getItem(r)&&localStorage.getItem(e)&&(localStorage.setItem(r,"1"),localStorage.removeItem(e),s("migrated legacy flag"))}catch{}const a=new URL(location.href).searchParams.has("intro"),n=!!localStorage.getItem(r),l=!!sessionStorage.getItem(t);if(s("init",{hasStarted:n,sessionShown:l,urlForce:a,allowFlag:window.__WQ_ALLOW_START}),a){s("forcing intro via ?intro");try{localStorage.removeItem(r),localStorage.removeItem(e)}catch{}sessionStorage.removeItem(t),v(),i=!0,sessionStorage.setItem(t,"1")}else l?n||(s("rebuilding overlay (not started yet this session)"),v(),i=!0):(v(),i=!0,sessionStorage.setItem(t,"1"));const d=document.getElementById("resetIntroBtn");d&&d.addEventListener("click",()=>{s("manual reset");try{localStorage.removeItem(r),localStorage.removeItem(e)}catch{}try{sessionStorage.removeItem(t)}catch{}window.__WQ_ALLOW_START=!1;const c=document.getElementById("welcomeOverlay");c&&c.remove(),v(),i=!0,sessionStorage.setItem(t,"1")});const f=document.getElementById("restartGameBtn");f&&f.addEventListener("click",()=>{s("hard restart invoked");try{localStorage.removeItem(r),localStorage.removeItem(e),sessionStorage.removeItem(t)}catch{}try{window.minigame&&(window.minigame.running=!1)}catch{}const c=document.getElementById("penaltyLog");c&&(c.innerHTML="");const g=document.getElementById("stats");g&&(g.innerHTML="");const w=document.getElementById("daysSurvived");if(w){const L=w.querySelector(".label");L&&(L.textContent="Day 1");const x=w.querySelector(".progress");x&&(x.style.width="0%")}(async()=>{try{const L=await U(),x=new Y(L);window.game=x,j(x),H(x),P(x);const I=new Z(x,5e3);window.minigame=I,window.__WQ_ALLOW_START=!1,s("restart new instances ready");const k=document.getElementById("welcomeOverlay");k&&k.remove(),i=!1,v(),i=!0,sessionStorage.setItem(t,"1")}catch(L){s("restart failed",L)}})()});function u(){const c=document.getElementById("welcomeStartBtn");c&&c.addEventListener("click",()=>{var x,I;const g=document.getElementById("dayLenSlider"),w=document.getElementById("hardshipSlider");window.minigame&&g&&window.minigame.setDayDurationSeconds(Number(g.value)),window.game&&w&&window.game.setHardshipFactor(Number(w.value)),E.init(),window.__WQ_USER_START=!0,window.__WQ_ALLOW_START=!0;try{window.minigame.startDay(),s("startDay invoked from button")}catch(k){s("startDay failed from button",k)}try{localStorage.setItem(r,"1")}catch{}try{sessionStorage.setItem(t,"1")}catch{}const L=document.getElementById("welcomeOverlay");L&&L.remove();try{(I=(x=window.__WQ_OVERLAY_GUARD)==null?void 0:x.disconnect)==null||I.call(x),delete window.__WQ_OVERLAY_GUARD,s("guardian disconnected (user start)")}catch{}_&&(clearTimeout(_),_=null)})}const h=document.getElementById("detailsToggle");h&&h.addEventListener("click",()=>{const c=h.getAttribute("aria-expanded")==="true";h.setAttribute("aria-expanded",(!c).toString());const g=document.getElementById("detailsPanel");g&&g.classList.toggle("hidden",c)});const y=document.getElementById("dayLenSlider"),b=document.getElementById("dayLenValue");if(y&&b){const c=()=>b.textContent=y.value+"s";y.addEventListener("input",c),c()}const S=document.getElementById("hardshipSlider"),m=document.getElementById("hardshipValue"),F=document.getElementById("hardshipLabel");if(S&&m&&F){const c=w=>w<.75?"Easy: slower decay & more income":w<1.15?"Normal: standard decay & income":w<1.5?"Challenging: faster decay":w<1.9?"Hard: tough decay & reduced income":"Brutal: survival is rare",g=()=>{const w=Number(S.value);m.textContent=w.toFixed(1)+"x",F.textContent=c(w)};S.addEventListener("input",g),g()}const p=document.getElementById("soundToggle");p&&p.addEventListener("click",()=>{E.init();const c=E.toggle();p.textContent=c?"üîä":"üîá",p.setAttribute("aria-pressed",(!c).toString())}),window.addEventListener("pointerdown",A,{once:!0,passive:!0}),window.addEventListener("keydown",A,{once:!0});function A(){var c;try{(c=window.audioManager)==null||c.init()}catch{}}function v(){if(document.getElementById("welcomeOverlay"))return;s("building overlay");const c=document.createElement("div");c.id="welcomeOverlay",c.style.cssText="position:fixed;inset:0;background:linear-gradient(135deg,#123050,#0d1e33);color:#fff;display:flex;align-items:center;justify-content:center;z-index:2000;padding:1rem;",c.innerHTML=`
      <div style="background:#152a43;width:min(560px,92%);max-height:92%;overflow:auto;border-radius:24px;padding:1.35rem 1.4rem 1.55rem;box-shadow:0 12px 42px -8px rgba(0,0,0,0.65);display:flex;flex-direction:column;gap:1rem;font-size:0.85rem;line-height:1.4;">
        <div style="display:flex;flex-direction:row;align-items:flex-start;gap:0.9rem;">
          <img src="icons/icon-192.png" alt="WellnessQuest Icon" width="72" height="72" style="border-radius:18px;flex:0 0 auto;box-shadow:0 4px 14px -4px rgba(0,0,0,0.55);background:#0f1826;object-fit:cover;" />
          <div style="display:flex;flex-direction:column;gap:0.65rem;">
            <h2 style="margin:0;font-size:1.35rem;letter-spacing:.5px;font-weight:700;">Welcome to WellnessQuest</h2>
            <p style="margin:0;font-size:0.78rem;opacity:0.9;">Balance nutrition, fitness, mood, and energy. Collect foods and maybe hit the gym each day. Avoid excess while preventing deficiencies.</p>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:0.5rem;background:#0f1f33;padding:0.75rem 0.85rem 0.9rem;border:1px solid #1e3d62;border-radius:16px;">
          <label for="dayLenSlider" style="font-size:0.72rem;font-weight:600;letter-spacing:.5px;text-transform:uppercase;color:#b9d6ff;">Day Duration <span id="dayLenValue" style="color:#fff;font-weight:700;margin-left:4px;">5s</span></label>
          <input id="dayLenSlider" type="range" min="5" max="20" step="1" value="5" style="width:100%;accent-color:#4a8fff;" />
          <div style="display:flex;justify-content:space-between;font-size:0.55rem;letter-spacing:.5px;opacity:0.7;margin-top:-4px;"><span>Faster</span><span>Slower</span></div>
          <div style="margin-top:0.6rem;display:flex;flex-direction:column;gap:0.5rem;">
            <label for="hardshipSlider" style="font-size:0.72rem;font-weight:600;letter-spacing:.5px;text-transform:uppercase;color:#b9d6ff;">Life Hardship <span id="hardshipValue" style="color:#fff;font-weight:700;margin-left:4px;">1.0x</span></label>
            <input id="hardshipSlider" type="range" min="0.5" max="2" step="0.1" value="1" style="width:100%;accent-color:#ff8d3a;" />
            <div style="display:flex;justify-content:space-between;font-size:0.5rem;letter-spacing:.5px;opacity:0.65;"><span>Easy</span><span>Normal</span><span>Brutal</span></div>
            <div id="hardshipLabel" style="font-size:0.55rem;letter-spacing:.5px;color:#ffd5b0;font-weight:600;text-align:center;">Normal: standard decay & income</div>
          </div>
        </div>
        <div>
          <button id="detailsToggle" aria-expanded="false" style="background:#23466d;color:#fff;border:1px solid #3a6a9d;padding:0.5rem 0.8rem;font-size:0.65rem;border-radius:10px;cursor:pointer;letter-spacing:.5px;font-weight:600;">Show Detailed Rules ‚ñæ</button>
        </div>
        <div id="detailsPanel" class="hidden" style="background:#0f1f33;border:1px solid #1d3a5d;padding:0.8rem 0.85rem 0.95rem;border-radius:16px;font-size:0.66rem;display:flex;flex-direction:column;gap:0.55rem;">
          <div style="font-weight:600;letter-spacing:.5px;text-transform:uppercase;font-size:0.55rem;color:#b6d4ff;">Health & Risk System</div>
          <ul style="margin:0 0 0 1.1rem;padding:0;display:flex;flex-direction:column;gap:0.25rem;">
            <li>Deficiencies (vitamins / minerals / protein) hurt health.</li>
            <li>Excess sugar/cholesterol/sodium penalize at 100+, worse at 110+.</li>
            <li>Low energy or mood stacks penalties.</li>
            <li>Good fitness + mood + energy gives a bonus.</li>
            <li>Streak of healthy meals adds a bonus.</li>
          </ul>
        </div>
        <button id="welcomeStartBtn" style="background:#4a8fff;color:#fff;border:none;padding:0.9rem 1.2rem;font-size:0.9rem;font-weight:600;border-radius:14px;cursor:pointer;letter-spacing:.5px;box-shadow:0 4px 12px -3px rgba(0,0,0,0.5);">Start Day 1 ‚ñ∏</button>
        <div style="text-align:center;font-size:0.5rem;letter-spacing:.5px;opacity:0.5;">v0.1 prototype</div>
      </div>`,document.body.appendChild(c),ye(v,o),ge(v,o),u()}u(),setTimeout(()=>{var x;const c=(x=window.minigame)==null?void 0:x.running,g=!!document.getElementById("welcomeOverlay"),w=!!localStorage.getItem(r),L=!!sessionStorage.getItem(t);if(!c&&!g&&!L&&!i){s("fallback phase1 inject (no overlay, not running)"),v(),i=!0,sessionStorage.setItem(t,"1");return}!w&&!g&&!c&&(s("scheduling second check (overlay still missing)"),setTimeout(()=>{var W;const I=!!document.getElementById("welcomeOverlay"),k=!!localStorage.getItem(r),J=(W=window.minigame)==null?void 0:W.running;!I&&!k&&!J&&(s("second check force inject (still missing)"),v())},900))},800),window.forceIntro=()=>{try{localStorage.removeItem(r),sessionStorage.removeItem(t)}catch{}const c=document.getElementById("welcomeOverlay");c&&c.remove(),i=!1,v(),i=!0,s("forceIntro invoked")}});
//# sourceMappingURL=index-Fb04Jmg6.js.map
