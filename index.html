<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WellnessQuest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#3f6cb3" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png" />
  <style>
    :root { --pad: 1rem; }
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 0; background:#f5f7fa; color:#222; -webkit-font-smoothing:antialiased; }
    .app-shell { max-width:600px; margin:0 auto; background:#f5f7fa; min-height:100dvh; display:flex; flex-direction:column; }
  header { background:#3f6cb3; color:#fff; padding:1rem 1.1rem; display:flex; align-items:center; gap:0.8rem; }
  .app-logo { width:40px; height:40px; border-radius:12px; object-fit:cover; box-shadow:0 4px 10px -3px rgba(0,0,0,0.45); background:#0f1826; flex:0 0 auto; }
  @media (max-width:520px){ .app-logo { width:34px; height:34px; border-radius:10px; } }
    h1 { margin:0; font-size:clamp(1.3rem, 4vw, 1.6rem); }
  main { padding:0.9rem 1.1rem 1.2rem; display:grid; gap:1rem; grid-template-columns: 300px 1fr; align-items:start; box-sizing:border-box; }
    section { background:#fff; border-radius:12px; padding:0.85rem 1rem 1rem; box-shadow:0 4px 8px -2px rgba(0,0,0,0.08); }
  /* Compact stats adjustments */
  .stats-grid { display:flex; flex-direction:column; gap:0.25rem; }
  .stat-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(50px,1fr)); gap:0.18rem; }
  .stat.compact { background:#eef3f9; padding:0.22rem 0.28rem 0.26rem; border-radius:7px; font-size:0.63rem; display:flex; flex-direction:column; align-items:center; gap:0.11rem; line-height:1.05; }
  .stat.compact .icon { font-size:0.92rem; line-height:1; }
  .stat.compact .val { font-size:0.66rem; line-height:1.05; }
  @media (max-width: 860px) { .stat-row { grid-template-columns:repeat(auto-fit,minmax(56px,1fr)); } }
  .stat.compact .icon { font-size:0.98rem; line-height:1; }
  .stat.compact .val { font-weight:600; font-size:0.7rem; }
  .stat.compact .delta { font-size:0.55rem; font-weight:600; padding:2px 4px; border-radius:6px; margin-top:-2px; }
  .stat.compact .delta.up { background:#e6fbe9; color:#137b27; }
  .stat.compact .delta.down { background:#ffefef; color:#c02727; }
  /* Stat highlight states */
  .stat.compact.warning { background:linear-gradient(135deg,#fff8e1,#ffe8a3); box-shadow:0 0 0 2px #f5c453 inset; }
  .stat.compact.danger { background:linear-gradient(135deg,#ffe5e5,#ffc4c4); box-shadow:0 0 0 2px #e45454 inset; }
  .stat.compact.warning .val, .stat.compact.warning .icon { color:#7a5212; }
  .stat.compact.danger .val, .stat.compact.danger .icon { color:#7a1616; }
  /* Ultra-compact on smaller screens */
  @media (max-width:640px){
    .stat.compact { padding:0.18rem 0.22rem 0.22rem; font-size:0.6rem; gap:0.09rem; }
    .stat.compact .icon { font-size:0.88rem; }
    .stat.compact .val { font-size:0.62rem; }
  }
  @media (max-width:480px){
    .stats-grid { gap:0.2rem; }
    .stat-row { gap:0.14rem; }
    .stat.compact { padding:0.16rem 0.2rem 0.18rem; font-size:0.57rem; border-radius:6px; }
    .stat.compact .icon { font-size:0.82rem; }
    .stat.compact .val { font-size:0.58rem; }
    .stat.compact .delta { font-size:0.48rem; }
  }
  /* New compact stats bar */
  .stats-bar { display:flex; flex-wrap:nowrap; overflow-x:auto; background:#eef3f9; padding:4px 6px; border-radius:10px; gap:4px; scrollbar-width:none; }
  .stats-bar::-webkit-scrollbar { display:none; }
  .stat-seg { display:inline-flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:1px; background:#dfe8f2; padding:2px 3px 3px; border-radius:6px; font-size:0.5rem; font-weight:600; position:relative; min-width:36px; }
  .stat-seg .i { font-size:0.8rem; line-height:1; }
  .stat-seg .v { font-size:0.5rem; line-height:1; }
  .stat-seg .delta { font-size:0.44rem; margin-top:0; }
  /* Nutrient row inline value next to icon */
  .stats-bar.nutrient-bar { background:#f2f5fa; }
  .stat-seg.nutrient { flex-direction:row; align-items:center; gap:4px; padding:2px 5px 2px; min-width:42px; }
  .stats-bar + .stats-bar { margin-top:4px; }
  .stat-seg.nutrient .i { display:inline-flex; align-items:center; gap:3px; font-size:0.78rem; }
  .stat-seg.nutrient .v.inline { font-size:0.55rem; font-weight:700; line-height:1; }
  .stat-seg.nutrient .delta { margin-left:2px; }
  @media (max-width:480px){ .stat-seg.nutrient { padding:1px 4px 1px; gap:3px; } .stat-seg.nutrient .i { font-size:0.7rem; } .stat-seg.nutrient .v.inline { font-size:0.48rem; } }
  @media (max-width:600px){ .stat-seg { padding:2px 2px 3px; min-width:34px; } .stat-seg .i { font-size:0.75rem; } }
  @media (max-width:480px){ .stats-bar { gap:3px; } .stat-seg { min-width:30px; padding:1px 2px 2px; } .stat-seg .i { font-size:0.7rem; } .stat-seg .v { font-size:0.45rem; } .stat-seg .delta { font-size:0.4rem; } }
  .stat-seg.warning { background:linear-gradient(135deg,#fff3cf,#ffd980); }
  .stat-seg.danger { background:linear-gradient(135deg,#ffd1d1,#ffb3b3); }
  @media (max-width:600px){ .stats-bar { font-size:0.5rem; gap:3px; } .stat-seg { padding:2px 4px; } }
  /* Days survived badge */
  .days-badge { background:#0f1826; color:#fff; padding:2px 6px; border-radius:8px; font-size:0.6rem; letter-spacing:.5px; font-weight:600; box-shadow:0 2px 4px rgba(0,0,0,0.25); }
  .days-badge { position:relative; overflow:hidden; display:inline-flex; align-items:center; justify-content:center; }
  .days-badge .progress { position:absolute; inset:0; background:linear-gradient(90deg,#3f6cb3,#6fa4ff); width:0%; transition:width .12s linear; opacity:0.35; }
  .days-badge .label { position:relative; z-index:1; }
  .days-badge.animate-day { animation: dayPulse 0.7s ease; }
  @keyframes dayPulse { 0% { transform:scale(0.7); filter:brightness(1.6); background:#1e3350; } 40% { transform:scale(1.18); } 60% { transform:scale(0.94); } 100% { transform:scale(1); } }
  .mini-btn { background:#203044; color:#fff; border:1px solid #395272; padding:2px 6px; font-size:0.6rem; line-height:1; border-radius:6px; cursor:pointer; letter-spacing:.5px; }
  .mini-btn:hover, .mini-btn:focus { background:#2d4765; outline:none; }
  .mini-btn[aria-pressed="true"] { background:#5c254d; border-color:#87376d; }
  /* Penalty / day report log */
  #penaltyLog { margin-top:0.6rem; max-height:150px; overflow:auto; font-size:0.62rem; line-height:1.15; padding:0.5rem 0.55rem; background:#f0f4f9; border:1px solid #d7e2ef; border-radius:8px; box-shadow:0 1px 2px rgba(0,0,0,0.06) inset; width:100%; box-sizing:border-box; }
  #penaltyLog .line { padding:2px 3px; border-radius:4px; }
  #penaltyLog .line + .line { margin-top:2px; }
    /* Ultra-narrow phones (e.g., iPhone 12 mini 375px) */
    @media (max-width:400px){
      main { padding:0.6rem 0.55rem 0.9rem; }
  .grid { padding:2px; gap:2px; grid-template-columns:20px repeat(4, 1fr) 30px; }
      .row-label { font-size:0.45rem; }
      .cell { font-size:1.05rem; }
      .grid-emoji { font-size:1.15rem; }
      .grid-label { font-size:0.46rem; }
      .grid-details { font-size:0.38rem; }
      .stats-bar { padding:3px 4px; gap:2px; }
      .stat-seg { min-width:28px; padding:1px 2px 2px; }
      .stat-seg .i { font-size:0.64rem; }
      .stat-seg .v { font-size:0.42rem; }
      .stat-seg .delta { font-size:0.36rem; }
      #penaltyLog { font-size:0.55rem; }
      #countdown { font-size:0.48rem; }
      h1 { font-size:1.1rem; }
      .days-badge { font-size:0.5rem; padding:2px 5px; }
      #pauseBtn.mini-btn { padding:2px 4px; font-size:0.5rem; }
    }
  #penaltyLog .day { font-weight:700; color:#1d3557; }
  #penaltyLog .penalty { background:#ffefef; color:#a12323; }
  #penaltyLog .bonus { background:#e9fbe9; color:#1f6e2a; }
  #penaltyLog .neutral { color:#334; }
    .foods, .fitness, .jobs { display:flex; flex-wrap:wrap; gap:0.55rem; }
  button.choice { cursor:pointer; background:#fff; border:1px solid #d0dae7; border-radius:14px; padding:0.55rem 0.55rem; font-size:1.2rem; min-width:54px; min-height:54px; text-align:center; display:flex; align-items:center; justify-content:center; transition: all .15s; line-height:1; }
    button.choice:hover, button.choice:focus { border-color:#3f6cb3; box-shadow:0 0 0 3px rgba(63,108,179,0.25); outline:none; }
    button.primary { background:#3f6cb3; color:#fff; border:none; padding:0.85rem 1.3rem; font-size:0.95rem; border-radius:10px; cursor:pointer; font-weight:600; letter-spacing:.5px; }
    button.primary:active { transform:translateY(1px); }
    button.primary:hover { background:#335b96; }
    .panel-title { margin:0 0 .5rem; font-size:0.85rem; letter-spacing:.5px; font-weight:700; color:#345; text-transform:uppercase; }
    #log { font-size:0.7rem; max-height:260px; overflow:auto; white-space:pre-line; background:#101828; color:#e6eefc; padding:0.6rem 0.7rem; border-radius:6px; }
    .notif { background:#ffe9e9; color:#b30000; padding:0.55rem 0.65rem; border:1px solid #ffb5b5; border-radius:6px; font-size:0.7rem; margin-top:0.4rem; }
    footer { grid-column:1 / -1; text-align:center; font-size:0.65rem; padding:1rem 0; color:#667; }
    .selected { outline:3px solid #3f6cb3; }
    .jobs select { padding:0.45rem 0.5rem; font-size:0.8rem; border-radius:8px; border:1px solid #c6d3e2; }
    .jobs select:focus { outline:2px solid #3f6cb3; }
  /* Modal */
  .modal-overlay { position:fixed; inset:0; background:rgba(15,23,42,0.55); backdrop-filter:blur(4px); display:none; align-items:center; justify-content:center; z-index:1000; }
  .modal { background:#fff; width:min(520px,90%); border-radius:18px; padding:1.25rem 1.4rem 1.4rem; box-shadow:0 8px 28px -6px rgba(0,0,0,0.35); display:flex; flex-direction:column; gap:1rem; }
  .modal h3 { margin:0; font-size:1.05rem; letter-spacing:.5px; color:#1f2d3d; }
  .modal .choices { display:flex; flex-wrap:wrap; gap:0.55rem; }
  .modal button.choice { flex:1 1 calc(25% - 0.55rem); }
  .modal .actions-bar { display:flex; justify-content:flex-end; gap:0.6rem; margin-top:0.5rem; }
  .hidden { display:none !important; }
  .fade-in { animation:fade .25s ease; }
  @keyframes fade { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }
  /* Hide inline food/fitness lists (now handled by modal) */
  #foods, #fitnessActions { display:none !important; }
  /* Minigame grid */
  #minigame { margin-top:0.75rem; }
  .grid-wrapper { display:flex; flex-direction:column; gap:0.4rem; position:relative; overflow:hidden; }
  .grid-wrapper .grid-hud { position:absolute; top:4px; left:4px; right:4px; display:flex; align-items:center; justify-content:space-between; z-index:10; pointer-events:none; }
  .grid-wrapper .grid-hud .hud-left { display:flex; align-items:center; gap:6px; }
  .grid-wrapper .grid-hud button { pointer-events:auto; }
  .grid-wrapper .grid-hud .days-badge { background:#162538; box-shadow:0 2px 4px rgba(0,0,0,0.4); }
  @media (max-width:600px){
    .grid-wrapper .grid-hud { top:3px; left:3px; right:3px; }
  }
  .grid-stack { position:relative; }
  .grid.temp-shift { position:relative; }
  .grid-clone-layer { position:absolute; inset:0; pointer-events:none; }
  .grid.shifting { will-change:transform; }
  .grid { display:grid; grid-template-columns:24px repeat(4, 1fr); gap:3px; background:#0f1826; padding:6px; border-radius:10px; box-shadow:0 4px 18px -4px rgba(0,0,0,0.5) inset, 0 2px 4px rgba(0,0,0,0.4); overflow:hidden; }
  .grid.shift-transition { transition: transform .42s cubic-bezier(.45,.85,.4,1); }
  .cell { aspect-ratio:1/1; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:2rem; background:linear-gradient(145deg,#ffffff,#f2f6fa); border-radius:6px; position:relative; transition:transform .18s, box-shadow .18s, background .25s; }
  /* Mobile grid shrink */
  @media (max-width:600px){
    .grid { padding:3px; gap:2px; }
    .cell { font-size:1.2rem; }
    .grid-emoji { font-size:1.3rem; }
    .grid-label { font-size:0.5rem; }
    .grid-details { font-size:0.42rem; }
  }
  .grid-emoji { font-size:2.2rem; line-height:1.1; }
  .grid-label { font-size:0.75rem; color:#222; margin-top:2px; text-align:center; word-break:break-word; max-width:90%; }
  .grid-details { font-size:0.55rem; color:#555; margin-top:1px; text-align:center; word-break:break-word; max-width:95%; letter-spacing:0.2px; }
  .cell.fitness { background:linear-gradient(145deg,#e4f2ff,#d0e8ff); }
  .cell.food { background:linear-gradient(145deg,#fff3dc,#ffe8bd); }
  .cell.collected { background:radial-gradient(circle at 30% 30%, #b2ffbe, #59c46b); box-shadow:0 0 0 2px #2d9345 inset, 0 0 6px 2px rgba(86,207,118,0.5); transform:scale(.9); }
  .cell.player { box-shadow:0 0 0 3px #4a8fff, 0 0 10px 3px rgba(0,132,255,0.55), 0 0 22px 6px rgba(0,132,255,0.25); background:linear-gradient(145deg,#e7f2ff,#d4e9ff); animation:playerPulse 1.2s ease-in-out infinite; }
  .row-label { font-size:0.55rem; font-weight:600; letter-spacing:.5px; color:#dde4ef; writing-mode:vertical-rl; text-orientation:mixed; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.05); border-radius:4px; padding:2px 0; user-select:none; transform: rotate(180deg); }
  .future-strong + .row-label, .row-label.future-strong { filter:brightness(0.6) contrast(0.9); }
  .future-mid + .row-label, .row-label.future-mid { filter:brightness(0.8) contrast(0.95); }
  /* Row dimming states */
  .cell.future-strong { filter:brightness(0.35) saturate(0.55); position:relative; }
  .cell.future-strong::after { content:''; position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.65)); border-radius:6px; }
  .cell.future-strong .grid-label, .cell.future-strong .grid-details { opacity:0.18; }
  .cell.future-mid { filter:brightness(0.65) saturate(0.8); position:relative; }
  .cell.future-mid::after { content:''; position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.35)); border-radius:6px; }
  .cell.future-mid .grid-label, .cell.future-mid .grid-details { opacity:0.55; }
  /* Fixed arrow refresh button */
  .fixed-refresh-btn { position:absolute; bottom:6px; right:6px; width:40px; height:40px; border-radius:8px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(145deg,#e4ecff,#d4e0ff); font-size:1.2rem; cursor:pointer; box-shadow:0 0 0 2px #ffffff1a inset, 0 0 8px -1px rgba(0,0,0,0.5); transition:transform .18s, box-shadow .25s; z-index:5; }
  .fixed-refresh-btn span { font-size:0.45rem; font-weight:600; letter-spacing:.5px; color:#1c2b40; margin-top:1px; }
  .fixed-refresh-btn:hover:not(.used) { box-shadow:0 0 0 3px #4a8fff, 0 0 10px 3px rgba(0,132,255,0.45); }
  .fixed-refresh-btn.used { filter:grayscale(.55) brightness(.9); opacity:.65; cursor:default; }
  .fixed-refresh-btn:active:not(.used) { transform:scale(.94); }
  @media (max-width:600px){ .fixed-refresh-btn { width:34px; height:34px; font-size:1rem; bottom:3px; right:3px; } .fixed-refresh-btn span { font-size:0.38rem; } }
  @keyframes playerPulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.06); } }
  #countdown { font-size:0.55rem; font-weight:500; letter-spacing:.5px; color:#556; opacity:0.7; }
  #startDayBtn { margin-top:0.4rem; }
  @media (max-width:520px){ .cell { font-size:0.95rem; } }
  /* Stat tooltip bubble */
  .stat-tooltip-bubble { position:fixed; background:#1e293b; color:#fff; font-size:0.65rem; padding:4px 8px; border-radius:6px; box-shadow:0 4px 14px -2px rgba(0,0,0,0.35); z-index:2000; pointer-events:none; animation:fade .18s ease; letter-spacing:.5px; }
  .stat-tooltip-bubble::after { content:''; position:absolute; left:50%; transform:translateX(-50%); bottom:-5px; width:8px; height:8px; background:#1e293b; clip-path:polygon(50% 100%,0 0,100% 0); }
    /* Scroll behavior improvements on mobile */
    * { -webkit-tap-highlight-color: rgba(0,0,0,0); }
    /* Responsive layout */
    @media (max-width: 860px) {
      main { grid-template-columns: 1fr; padding:0.8rem 0.9rem 1.2rem; }
      section { padding:0.8rem 0.85rem 0.95rem; }
      .stat-row { grid-template-columns:repeat(auto-fit,minmax(60px,1fr)); }
      button.choice { flex:1 1 calc(16.6% - 0.55rem); font-size:1.15rem; }
      #log { max-height:200px; font-size:0.68rem; }
    }
    @media (max-width: 520px) {
      h1 { font-size:1.35rem; }
      button.choice { flex:1 1 calc(25% - 0.55rem); min-width:unset; padding:0.5rem; font-size:1.05rem; }
      button.primary { width:100%; }
      #log { max-height:180px; }
    }
    @media (pointer:coarse) {
      button.choice { padding:0.7rem 0.75rem; }
      button.primary { padding:0.95rem 1.4rem; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
  <header>
  <img src="/icons/icon-192.png" alt="WellnessQuest icon" class="app-logo" />
    <h1 style="flex:1;">WellnessQuest</h1>
  <button id="resetIntroBtn" class="mini-btn" type="button" title="Reset / Show Intro" style="background:#254b74;">Intro</button>
  <button id="restartGameBtn" class="mini-btn" type="button" title="Hard Restart Game" style="background:#5c254d;">Restart</button>
  </header>
  <main>
    <section>
      <h2 class="panel-title">Player Stats</h2>
      <div id="stats" class="stats-grid"></div>
  <div id="diseaseNotifications"></div>
    </section>

    <section>
      <div id="minigame">
  <div class="grid-wrapper">
    <div class="grid-hud">
      <div class="hud-left">
  <button id="pauseBtn" type="button" aria-pressed="false" title="Pause / Resume" class="mini-btn">⏸</button>
  <button id="soundToggle" type="button" aria-pressed="true" title="Mute / Unmute" class="mini-btn" style="min-width:38px;">🔊</button>
  <span id="daysSurvived" class="days-badge" title="Days survived"><span class="progress"></span><span class="label">Day 1</span></span>
      </div>
    </div>
    <div id="gameGrid" class="grid"></div>
  </div>
  <div id="penaltyLog" class="penalty-log" aria-live="polite" style="margin-top:0.6rem;"></div>
      </div>
    </section>
  </main>
  <div id="actionModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalQuestion">
    <div class="modal fade-in" tabindex="-1">
      <h3 id="modalQuestion">What are we eating today?</h3>
      <div id="modalChoices" class="choices"></div>
      <div class="actions-bar">
        <button id="modalSkip" class="choice" style="font-size:0.7rem; min-width:80px;">Skip</button>
        <button id="modalNext" class="primary" disabled>Next</button>
      </div>
    </div>
  </div>
  <footer>
    Starter build. Extend for persistence, effects, sound, animations later.
  </footer>
  </div><!-- /.app-shell -->
  <script type="module" src="./main.ts"></script>
</body>
</html>
